[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Contact",
  "enabled": 1,
  "modified": "2022-11-07 12:05:42.535282",
  "name": "Contact-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on(\"Contact\", \"contact_address\", function(frm, cdt, cdn) {\n    if(frm.doc.contact_address){\n     return frm.call({\n      method: \"frappe.contacts.doctype.address.address.get_address_display\",\n      args: {\n        \"address_dict\": frm.doc.contact_address\n      },\n      callback: function(r) {\n       if(r.message)\n           frm.set_value(\"full_address\", r.message);\n        \n      }\n        });\n    }\n    else{\n        frm.set_value(\"full_address\", \"\");\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Enquiry",
  "enabled": 1,
  "modified": "2024-01-06 16:27:49.065823",
  "name": "Enquiry-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on(\"Enquiry\", {\n    onload_post_render: function (frm) {\n        if (cur_frm.doc.lead && cur_frm.is_new()) {\n            frappe.db.get_doc('Lead', cur_frm.doc.lead)\n                .then(doc => {\n\n                    cur_frm.set_value(\"enquiry_from\", \"Lead\")\n                    cur_frm.set_value(\"customer\", doc.company_name)\n                    let data = doc.items\n                    cur_frm.doc.items = []\n                    for (var i = 0; i < data.length; i++) {\n                        var childTable = cur_frm.add_child(\"items\");\n                        childTable.item_code = data[i]['item_code']\n                        childTable.item_name = data[i]['item_name']\n                        childTable.item_group = data[i]['item_group']\n                        childTable.description = data[i]['description']\n                        // frappe.model.set_value(childTable.doctype, childTable.name, \"item_code\", data[i]['item_code'])\n                        frappe.model.set_value(childTable.doctype, childTable.name, \"qty\", data[i]['qty'])\n                        frappe.model.set_value(childTable.doctype, childTable.name, \"uom\", data[i]['uom'])\n\n                        childTable.rate = data[i]['rate']\n\n\n\n\n\n                    }\n                })\n\n        }\n    },\n    customer: function (frm) {\n        if (frm.doc.customer) {\n            frm.fields_dict.customer_address.get_query = function (doc, cdt, cdn) {\n                var d = locals[cdt][cdn];\n                console.log(d)\n                return {\n                    filters: {\n                        \"link_doctype\": \"Customer\",\n                        \"link_name\": d.customer\n                    }\n                };\n            };\n            frm.fields_dict.contact.get_query = function (doc, cdt, cdn) {\n                return {\n                    filters: {\n                        \"link_doctype\": \"Customer\",\n                        \"link_name\": frm.doc.customer\n                    }\n                };\n            };\n\t\t\tfrappe.db.get_list('Dynamic Link', {\n\t\t\t\tfields: ['*'],\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: 'Customer',\n\t\t\t\t\tlink_name: frm.doc.customer,\n\t\t\t\t\tparenttype:\"Address\"\n\t\t\t\t}\n\t\t\t}).then(r => {\n\t\t\t\tif (r.length == 1) {\n\t\t\t\t\tcur_frm.set_value(\"customer_address\", r[0][\"parent\"])\n\t\t\t\t}\n\t\t\t})\n\t\t}\n    },\n    customer_address: function (frm) {\n        if (frm.doc.customer_address) {\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Address\",\n                    name: frm.doc.customer_address,\n                },\n                callback: function (response) {\n                    if (response.message) {\n                        var address = response.message;\n                        console.log(address)\n                        var custom_address_display = '';\n                        if (address.address_line1) custom_address_display += address.address_line1 + '\\n';\n                        if (address.address_line2) custom_address_display += address.address_line2 + '\\n';\n                        if (address.city) custom_address_display += address.city + '\\n';\n                        if (address.state) custom_address_display += address.state + '\\n';\n                        if (address.pincode) custom_address_display += address.pincode + '\\n';\n                        if (address.country) custom_address_display += address.country + '\\n';\n                        if (address.email_id) custom_address_display += address.email_id + '\\n';\n                        if (address.phone) custom_address_display += address.phone;\n\n                    \n                        frm.set_value('address_display', custom_address_display);\n                    }\n                    console.log(response)\n                }\n            })\n        }\n    },\n    enquiry_from:function(frm){\n        if(cur_frm.doc.enquiry_from==\"Lead\"){\n            cur_frm.set_df_property(\"customer\", \"label\", \"Lead\");\n        }\n    },\n    lead:function(frm){\n        if(cur_frm.doc.lead){\n            \n         frappe.db.get_doc('Lead', cur_frm.doc.lead)\n\t\t\t.then(doc => {\n\t\t\t   \n\n\t\t\t\tcur_frm.set_value(\"customer\",doc.company_name)\n\t\t\t})\n        }\n        \n    },\n    contact: function (frm) {\n        if (frm.doc.contact) {\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Contact\",\n                    name: frm.doc.contact,\n                },\n                callback: function (response) {\n                    if (response.message) {\n                        var contact = response.message;\n                        console.log(contact);\n\n                        if (contact.contact_details) contact +=  contact.contact_details\n                            // Clear existing rows from \"contact_details\" child table in Enquiry\n                            frm.clear_table(\"contact_details\");\n                            frm.set_value('contact_email', contact.email_id);\n                            frm.set_value('contact_mobile', contact.mobile_no);\n                        \n                    }\n                }\n            });\n        }\n    }\n});\n\nfrappe.ui.form.on('Enquiry Item', {\n    item_code: function(frm, cdt, cdn) {\n        var child = locals[cdt][cdn];\n        fetch_uom(frm, child);\n    },\n\n    rate: function(frm, cdt, cdn) {\n        calculate_amount(frm, cdt, cdn);\n    },\n\n    qty: function(frm, cdt, cdn) {\n        calculate_amount(frm, cdt, cdn);\n    }\n});\n\nfunction fetch_uom(frm, child) {\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            doctype: 'Item',\n            filters: { name: child.item_code },\n            fieldname: 'stock_uom'\n        },\n        callback: function(response) {\n            if (response && response.message) {\n                child.uom = response.message.stock_uom;\n                frm.fields_dict['items'].grid.refresh();\n            }\n        }\n    });\n}\n\nfunction calculate_amount(frm, cdt, cdn) {\n    var child = locals[cdt][cdn];\n    child.amount = flt(child.rate) * flt(child.qty);\n    frm.fields_dict['items'].grid.refresh();\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2024-01-05 17:04:41.456634",
  "name": "Quotation-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Quotation', {\r\n    onload: function (frm) {\r\n        if (cur_frm.doc.enquiry && cur_frm.is_new()) {\r\n            frappe.db.get_doc('Enquiry', cur_frm.doc.enquiry)\r\n                .then(doc => {\r\n                    cur_frm.doc.items=[]\r\n                      cur_frm.set_value(\"party_name\", doc.customer)  \r\n                    // if(cur_frm.doc.enquiry_from==\"Customer\"){\r\n                    // }\r\n                    // if(cur_frm.doc.enquiry_from==\"Lead\"){\r\n                    //   cur_frm.set_value(\"party_name\", doc.organization_name)  \r\n                    // }\r\n                    \r\n                    cur_frm.set_value(\"email_address\", doc.email_id)\r\n                    cur_frm.set_value(\"customer_address\", doc.customer_address)\r\n                    let data = doc.items\r\n                    for (var i = 0; i < data.length; i++) {\r\n                        var childTable = cur_frm.add_child(\"items\");\r\n                        childTable.item_code=data[i]['item_code']\r\n                        childTable.item_name=data[i]['item_name']\r\n                        childTable.item_group=data[i]['item_group']\r\n                        childTable.description=data[i]['description']\r\n                        // frappe.model.set_value(childTable.doctype, childTable.name, \"item_code\", data[i]['item_code'])\r\n                        frappe.model.set_value(childTable.doctype, childTable.name, \"qty\", data[i]['qty'])\r\n                        frappe.model.set_value(childTable.doctype, childTable.name, \"uom\", data[i]['uom'])\r\n                      \r\n                        childTable.rate=data[i]['rate']\r\n                       \r\n                      \r\n\r\n\r\n\r\n                    }\r\n\r\n\r\n\r\n                })\r\n        }\r\n    },\r\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2024-01-06 16:29:36.148074",
  "name": "Lead-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Lead', {\n// \trefresh(frm) {\n// \t\t// your code here\n// \t}\nog_name:function(frm){\n    \n      cur_frm.set_value(\"company_name\",cur_frm.doc.og_name)\n    \n},\nvalidate:function(frm){\n    if(cur_frm.doc.og_name!=cur_frm.doc.company_name){\n          cur_frm.set_value(\"company_name\",cur_frm.doc.og_name)\n    }\n}\n})\nfrappe.ui.form.on('Enquiry Item', {\n    item_code: function(frm, cdt, cdn) {\n        var child = locals[cdt][cdn];\n        fetch_uom(frm, child);\n    },\n\n    rate: function(frm, cdt, cdn) {\n        calculate_amount(frm, cdt, cdn);\n    },\n\n    qty: function(frm, cdt, cdn) {\n        calculate_amount(frm, cdt, cdn);\n    }\n});\n\nfunction fetch_uom(frm, child) {\n    frappe.call({\n        method: 'frappe.client.get_value',\n        args: {\n            doctype: 'Item',\n            filters: { name: child.item_code },\n            fieldname: 'stock_uom'\n        },\n        callback: function(response) {\n            if (response && response.message) {\n                child.uom = response.message.stock_uom;\n                frm.fields_dict['items'].grid.refresh();\n            }\n        }\n    });\n}\n\nfunction calculate_amount(frm, cdt, cdn) {\n    var child = locals[cdt][cdn];\n    child.amount = flt(child.rate) * flt(child.qty);\n    frm.fields_dict['items'].grid.refresh();\n}\n",
  "view": "Form"
 }
]